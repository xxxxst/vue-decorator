{"version":3,"file":"vue-decorator.esm.js","sources":["../src/Comp.ts","../src/Inject.ts","../src/Model.ts","../src/Prop.ts","../src/Provide.ts","../src/Watch.ts","../src/State.ts"],"sourcesContent":["\r\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) xxxxst. All rights reserved.\r\n *  Licensed under the MIT License\r\n *--------------------------------------------------------------------------------------------\r\n*/\r\n\r\nimport { Component, computed } from 'vue';\r\nimport { createDecorator, Vue, VueConstructor } from 'vue-class-component';\r\n\r\n//class decorator\r\nexport default function Comp(comps?: Record<string, Component>) {\r\n\tcomps = comps || {};\r\n\r\n\treturn (target: VueConstructor<Vue>) => {\r\n\t\tvar obj = target[\"__o\"] || (target[\"__o\"] = {});\r\n\r\n\t\t// Component\r\n\t\tvar objComp = obj.components || (obj.components = {});\r\n\t\tfor (var key in comps) {\r\n\t\t\tobjComp[key] = comps[key];\r\n\t\t}\r\n\t\t\r\n\t\tvar needProxyComp = false;\r\n\r\n\t\t// Provide\r\n\t\tif (obj.provide) {\r\n\t\t\tvar objProvide = obj.provide;\r\n\t\t\tobj.provide = function () {\r\n\t\t\t\tvar rst = {};\r\n\t\t\t\tfor (var key in objProvide) {\r\n\t\t\t\t\trst[key] = computed(() => this[key]);\r\n\t\t\t\t}\r\n\t\t\t\treturn rst;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Inject\r\n\t\tvar mapInject = {};\r\n\t\tif (obj.inject) {\r\n\t\t\tneedProxyComp = true;\r\n\t\t\tfor (var i = 0; i < obj.inject.length; ++i) {\r\n\t\t\t\tmapInject[obj.inject[i]] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Model\r\n\t\tvar objProp = obj.props || (obj.props = {});\r\n\t\tif (!needProxyComp) {\r\n\t\t\tfor (var key in objProp) {\r\n\t\t\t\tif (objProp[key]._isModel) {\r\n\t\t\t\t\tneedProxyComp = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcreateDecorator((componentOptions, handler) => {\r\n\t\t\tvar mixins = componentOptions.mixins || (componentOptions.mixins = []);\r\n\r\n\t\t\tfunction initModel(obj) {\r\n\t\t\t\tvar oldProxy = obj[\"_\"].proxy;\r\n\t\t\t\tobj[\"_\"].proxy = new Proxy(oldProxy, {\r\n\t\t\t\t\tget: (target2, key2) => {\r\n\t\t\t\t\t\t// console.info(\"provide\", key2, mapInject);\r\n\t\t\t\t\t\tif (key2 in mapInject) {\r\n\t\t\t\t\t\t\treturn target2[key2].value;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn target2[key2];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tset: (target2, key2: any, value) => {\r\n\t\t\t\t\t\tif (!(key2 in objProp)) {\r\n\t\t\t\t\t\t\ttarget2[key2] = value;\r\n\t\t\t\t\t\t} else if (objProp[key2]._isModel) {\r\n\t\t\t\t\t\t\ttarget2.$emit(\"update:\" + key2, value);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttarget2[key2] = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tmixins.push({\r\n\t\t\t\tdata: function () {\r\n\t\t\t\t\t// Prop\r\n\t\t\t\t\tfor (var key in objProp) {\r\n\t\t\t\t\t\t// default value\r\n\t\t\t\t\t\tthis[\"_\"].props[key] = this[\"_\"].props[key] || objProp[key].default;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// init Model\r\n\t\t\t\t\tif (needProxyComp) {\r\n\t\t\t\t\t\tinitModel(this);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn {};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t})(target.prototype, key);\r\n\r\n\t\treturn class extends target {\r\n\t\t\tconstructor(...args) {\r\n\t\t\t\tsuper(...args);\r\n\r\n\t\t\t\tvar objProp = obj.props || (obj.props = {});\r\n\t\t\t\tfor (var key in objProp) {\r\n\t\t\t\t\tobjProp[key].default = this[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} as any;\r\n\t}\r\n}\r\n","\r\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) xxxxst. All rights reserved.\r\n *  Licensed under the MIT License\r\n *--------------------------------------------------------------------------------------------\r\n*/\r\n\r\nimport { Vue } from 'vue-class-component';\r\n\r\n//attribute decorator\r\nexport default function Inject() {\r\n\treturn (target: Vue, key: string) => {\r\n\t\tvar obj = target.constructor[\"__o\"] || (target.constructor[\"__o\"] = {});\r\n\t\tvar arrInject = obj.inject || (obj.inject = []);\r\n\t\t\r\n\t\tarrInject.push(key);\r\n\t}\r\n}\r\n","\r\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) xxxxst. All rights reserved.\r\n *  Licensed under the MIT License\r\n *--------------------------------------------------------------------------------------------\r\n*/\r\n\r\nimport { Vue } from 'vue-class-component';\r\n\r\n//attribute decorator\r\nexport default function Model() {\r\n\treturn (target: Vue, key: string) => {\r\n\t\tvar obj = target.constructor[\"__o\"] || (target.constructor[\"__o\"] = {});\r\n\t\tvar objMd = obj.props || (obj.props = {});\r\n\t\tvar objEmit = obj.emits || (obj.emits = {});\r\n\r\n\t\tvar keyFun = \"update:\" + key;\r\n\r\n\t\tobjMd[key] = {\r\n\t\t\ttype: [Object, Array, String, Number, Boolean, Function],\r\n\t\t\t_isModel: true,\r\n\t\t\tdefault: undefined\r\n\t\t};\r\n\r\n\t\tobjEmit[keyFun] = null;\r\n\t}\r\n}\r\n","\r\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) xxxxst. All rights reserved.\r\n *  Licensed under the MIT License\r\n *--------------------------------------------------------------------------------------------\r\n*/\r\n\r\nimport { Vue } from 'vue-class-component';\r\n\r\n//attribute decorator\r\nexport default function Prop() {\r\n\treturn (target: Vue, key: string) => {\r\n\t\tvar obj = target.constructor[\"__o\"] || (target.constructor[\"__o\"] = {});\r\n\t\tvar objProp = obj.props || (obj.props = {});\r\n\t\t\r\n\t\tobjProp[key] = {\r\n\t\t\ttype: [Object, Array, String, Number, Boolean, Function],\r\n\t\t\tdefault: undefined\r\n\t\t};\r\n\t}\r\n}\r\n","\r\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) xxxxst. All rights reserved.\r\n *  Licensed under the MIT License\r\n *--------------------------------------------------------------------------------------------\r\n*/\r\n\r\nimport { Vue } from 'vue-class-component';\r\n\r\n//attribute decorator\r\nexport default function Provide() {\r\n\treturn (target: Vue, key: string) => {\r\n\t\tvar obj = target.constructor[\"__o\"] || (target.constructor[\"__o\"] = {});\r\n\t\tvar objProvide = obj.provide || (obj.provide = {});\r\n\t\t\r\n\t\tobjProvide[key] = null;\r\n\t}\r\n}\r\n","\r\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) xxxxst. All rights reserved.\r\n *  Licensed under the MIT License\r\n *--------------------------------------------------------------------------------------------\r\n*/\r\n\r\nimport { Vue } from 'vue-class-component';\r\n\r\ninterface WathOption {\r\n\tname?: string;\r\n\tdeep?: boolean;\r\n\timmediate?: boolean;\r\n\tflush?: \"pre\" | \"post\" | \"sync\";\r\n}\r\n\r\nexport const DEEP = 0x1;\r\nexport const IMMEDIATE = 0x2;\r\n\r\n// Function decorator\r\nexport default function Watch(option?: WathOption | number) {\r\n\treturn (target: Vue, key: string, descriptor: any) => {\r\n\t\tvar obj = target.constructor[\"__o\"] || (target.constructor[\"__o\"] = {});\r\n\t\tvar objWatch = obj.watch || (obj.watch = {});\r\n\r\n\t\t// Wath attribute name\r\n\t\tvar name = \"\";\r\n\t\tif (typeof (option) == \"object\") {\r\n\t\t\tname = option.name || \"\";\r\n\t\t}\r\n\t\tif (name == \"\") {\r\n\t\t\tname = key.substr(0, key.length - \"Changed\".length);\r\n\t\t}\r\n\r\n\t\t// parse option\r\n\t\tvar tmp: any = {};\r\n\t\tif (typeof (option) == \"object\") {\r\n\t\t\t// option is WathOption\r\n\t\t\tfor (var key in option) {\r\n\t\t\t\tif (key == \"name\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttmp[key] = option[key];\r\n\t\t\t}\r\n\t\t} else if (typeof (option) == \"number\") {\r\n\t\t\t// option is number\r\n\t\t\tif (option & DEEP) {\r\n\t\t\t\ttmp.deep = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (option & IMMEDIATE) {\r\n\t\t\t\ttmp.immediate = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttmp.handler = descriptor.value;\r\n\t\tobjWatch[name] = tmp;\r\n\t}\r\n}\r\n","\r\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) xxxxst. All rights reserved.\r\n *  Licensed under the MIT License\r\n *--------------------------------------------------------------------------------------------\r\n*/\r\n\r\nimport { createDecorator, Vue } from 'vue-class-component';\r\n\r\n//attribute decorator\r\nexport default function State(attrName?: string) {\r\n\tfunction create(target: Vue, key: string) {\r\n\t\tvar name: string = attrName || key;\r\n\t\tname = name.trim();\r\n\r\n\t\tvar getVal = null;\r\n\t\tvar setVal = null;\r\n\r\n\t\tvar ch = \".\";\r\n\t\tif (name.charAt(0) == \"[\") {\r\n\t\t\tch = \"\";\r\n\t\t}\r\n\t\t\r\n\t\t/* eslint-disable */\r\n\t\tgetVal = eval(`(function() { return this.$store.state${ch}${name}; })`);\r\n\t\tsetVal = eval(`(function(val) { this.$store.state${ch}${name}=val; })`);\r\n\t\t/* eslint-disable */\r\n\r\n\t\tfunction initAttr(obj) {\r\n\t\t\tObject.defineProperty(obj, key, {\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tget: () => { return getVal.call(obj); },\r\n\t\t\t\tset: (value: any) => { setVal.call(obj, value); },\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tcreateDecorator((componentOptions, handler) => {\r\n\t\t\tvar mixins = componentOptions.mixins || (componentOptions.mixins = []);\r\n\r\n\t\t\tmixins.push({\r\n\t\t\t\tdata: function () {\r\n\t\t\t\t\tinitAttr(this);\r\n\t\t\t\t\treturn {};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t})(target, key);\r\n\t}\r\n\r\n\treturn create;\r\n}\r\n"],"names":["Comp","comps","target","obj","objComp","components","key","needProxyComp","provide","objProvide","rst","computed","_this","mapInject","inject","i","length","objProp","props","_isModel","createDecorator","componentOptions","handler","mixins","push","data","this","default","oldProxy","proxy","Proxy","get","target2","key2","value","set","$emit","initModel","prototype","_i","args","__extends","Inject","constructor","Model","objMd","objEmit","emits","keyFun","type","Object","Array","String","Number","Boolean","Function","undefined","Prop","Provide","DEEP","IMMEDIATE","Watch","option","descriptor","objWatch","watch","name","substr","tmp","deep","immediate","State","attrName","create","trim","getVal","setVal","ch","initAttr","defineProperty","enumerable","configurable","call","charAt","eval"],"mappings":"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"}